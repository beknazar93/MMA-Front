/* src/components/CRM/WhatsAppFunnel.scss */
/* Только цвета в :root */
:root{
  --surface:#ffffff;
  --ink:#0f172a;
  --muted:#6b7280;
  --border:#e5e7eb;
  --bg:#f7f7f9;
  --wa:#25d366;
  --ig:#e1306c;
  --ok:#10b981;
  --mid:#f59e0b;
  --lost:#ef4444;
  --accent:#3b82f6;
}

/* ===== Shell ===== */
.wa-app{
  $radius:14px; $shadow:0 10px 30px rgba(2,6,23,.08);
  background:var(--bg); min-height:100svh; padding:clamp(10px,2.5vw,16px);

  &__header{
    max-width:1240px; margin:0 auto 12px; background:var(--surface);
    border:1px solid var(--border); border-radius:$radius; box-shadow:$shadow;
    display:grid; grid-template-columns:1fr auto auto; align-items:center; gap:10px; padding:10px 12px;
    @media (max-width:880px){ grid-template-columns:1fr; gap:8px; }
  }
  &__brand{ font-weight:700; color:var(--ink); }

  &__mgr{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
  &__mgr-label{ color:var(--muted); font-size:12px; }
  &__mgr-select{ height:34px; border:1px solid var(--border); border-radius:8px; padding:0 10px; }
  &__mgr-add{ display:flex; gap:6px; }
  &__mgr-input{ height:34px; border:1px solid var(--border); border-radius:8px; padding:0 10px; min-width:160px; }
  &__mgr-btn{ height:34px; min-width:34px; border:1px solid var(--border); background:#fff; border-radius:8px; cursor:pointer; }

  &__tabs{ display:flex; gap:8px; justify-self:end; flex-wrap:wrap; }
  &__tab{
    padding:8px 12px; border:1px solid var(--border); background:#fff; border-radius:999px; cursor:pointer;
    &--active{ border-color:var(--accent); box-shadow:inset 0 0 0 2px rgba(59,130,246,.12); }
  }
}

/* ===== WhatsApp Chat ===== */
.wa-chat{
  $radius:14px;
  max-width:1240px; margin:0 auto; border:1px solid var(--border); border-radius:$radius; overflow:hidden; background:#fff;
  display:grid; grid-template-columns:360px 1fr; min-height:min(720px,78vh);
  @media (max-width:920px){ grid-template-columns:300px 1fr; }
  @media (max-width:760px){ grid-template-columns:1fr; }

  &__sidebar{ border-right:1px solid var(--border); display:flex; flex-direction:column; min-height:0; }
  &__sidebar-header{ height:56px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid var(--border); }
  &__brand{ font-weight:700; color:var(--wa); }
  &__actions{ color:var(--muted); }
  &__search{ padding:10px; border-bottom:1px solid var(--border); }
  &__search-input{ width:100%; height:36px; border:1px solid var(--border); border-radius:999px; padding:0 12px; color:var(--ink); background:#fff; }
  &__list{ list-style:none; margin:0; padding:0; overflow:auto; }
  &__item{ display:flex; gap:12px; align-items:center; padding:10px 12px; border-bottom:1px solid #f3f4f6; cursor:pointer; &:hover{ background:#fafafa; } }
  &__item--active{ background:#f5fff9; }
  &__avatar{ width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:var(--wa); color:#fff; font-weight:700; }
  &__avatar--sm{ width:36px; height:36px; font-size:12px; }
  &__cell{ flex:1; min-width:0; }
  &__row{ display:flex; justify-content:space-between; gap:8px; }
  &__name{ font-weight:600; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  &__time{ color:var(--muted); font-size:12px; }
  &__snippet{ color:var(--muted); font-size:13px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:220px; }
  &__badge{ min-width:22px; height:22px; border-radius:999px; background:var(--wa); color:#fff; display:flex; align-items:center; justify-content:center; font-size:12px; }
  &__badge--empty{ background:transparent; }

  &__thread{ display:flex; flex-direction:column; min-height:0; }
  &__thread-header{ height:56px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; padding:0 12px; gap:8px; }
  &__peer{ display:flex; align-items:center; gap:10px; }
  &__peer-name{ font-weight:600; }
  &__peer-status{ font-size:12px; color:var(--muted); }
  &__icons{ display:flex; gap:8px; }
  &__start, &__plus{
    height:32px; min-width:32px; padding:0 10px; border:1px solid var(--border); background:#fff; border-radius:999px; cursor:pointer;
  }
  &__plus{ font-weight:700; }

  &__messages{ flex:1; overflow:auto; background:linear-gradient(180deg,#f7fff9,#fff); padding:16px; display:grid; gap:10px; align-content:start; }
  &__bubble{ max-width:min(76%,560px); background:#fff; border:1px solid var(--border); border-radius:16px 16px 16px 4px; padding:10px 12px; font-size:14px; }
  &__bubble--me{ justify-self:end; background:#dcf8c6; border-color:#c6ebae; border-radius:16px 16px 4px 16px; }
  &__meta{ margin-top:6px; font-size:11px; color:var(--muted); text-align:right; }

  &__composer{ border-top:1px solid var(--border); height:56px; display:grid; grid-template-columns:40px 1fr 44px; align-items:center; gap:8px; padding:0 8px; }
  &__clip, &__send{ display:flex; align-items:center; justify-content:center; color:var(--muted); }
  &__input{ height:36px; border:1px solid var(--border); border-radius:999px; padding:0 12px; color:var(--ink); width:100%; }
  &__empty{ display:flex; align-items:center; justify-content:center; color:var(--muted); padding:20px; }

  @media (max-width:360px){
    &__sidebar-header{ height:52px; }
    &__search-input{ height:34px; font-size:13px; }
    &__avatar{ width:40px; height:40px; }
    &__snippet{ max-width:140px; }
    &__composer{ height:52px; grid-template-columns:36px 1fr 40px; }
  }
}

/* ===== Instagram Chat ===== */
.ig-chat{
  $radius:14px;
  max-width:1240px; margin:0 auto; border:1px solid var(--border); border-radius:$radius; overflow:hidden; background:#fff;
  display:grid; grid-template-columns:360px 1fr; min-height:min(720px,78vh);
  @media (max-width:920px){ grid-template-columns:300px 1fr; }
  @media (max-width:760px){ grid-template-columns:1fr; }

  &__sidebar{ border-right:1px solid var(--border); display:flex; flex-direction:column; min-height:0; }
  &__sidebar-header{ height:56px; display:flex; align-items:center; justify-content:space-between; padding:0 12px; border-bottom:1px solid var(--border); }
  &__brand{ font-weight:700; color:var(--ig); }
  &__actions{ color:var(--muted); }
  &__search{ padding:10px; border-bottom:1px solid var(--border); }
  &__search-input{ width:100%; height:36px; border:1px solid var(--border); border-radius:10px; padding:0 12px; color:var(--ink); background:#fff; }
  &__list{ list-style:none; margin:0; padding:0; overflow:auto; }
  &__item{ display:flex; gap:12px; align-items:center; padding:10px 12px; border-bottom:1px solid #f3f4f6; cursor:pointer; &:hover{ background:#fff7fb; } }
  &__item--active{ background:#fff0f6; }
  &__avatar{ width:44px; height:44px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg,var(--ig),#ffb3c7); color:#fff; font-weight:700; }
  &__avatar--sm{ width:36px; height:36px; font-size:12px; }
  &__cell{ flex:1; min-width:0; }
  &__row{ display:flex; justify-content:space-between; gap:8px; }
  &__name{ font-weight:600; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  &__time{ color:var(--muted); font-size:12px; }
  &__snippet{ color:var(--muted); font-size:13px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:220px; }
  &__badge{ min-width:22px; height:22px; border-radius:999px; background:var(--ig); color:#fff; display:flex; align-items:center; justify-content:center; font-size:12px; }
  &__badge--empty{ background:transparent; }

  &__thread{ display:flex; flex-direction:column; min-height:0; }
  &__thread-header{ height:56px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; padding:0 12px; gap:8px; }
  &__peer{ display:flex; align-items:center; gap:10px; }
  &__peer-name{ font-weight:600; }
  &__peer-status{ font-size:12px; color:var(--muted); }
  &__icons{ display:flex; gap:8px; }
  &__start, &__plus{
    height:32px; min-width:32px; padding:0 10px; border:1px solid var(--border); background:#fff; border-radius:999px; cursor:pointer;
  }
  &__plus{ font-weight:700; }

  &__messages{ flex:1; overflow:auto; background:linear-gradient(180deg,#fff7fb,#fff); padding:16px; display:grid; gap:10px; align-content:start; }
  &__bubble{ max-width:min(76%,560px); background:#fff; border:1px solid var(--border); border-radius:16px; padding:10px 12px; font-size:14px; }
  &__bubble--me{ justify-self:end; background:#fde2ef; border-color:#f7c6dc; }
  &__meta{ margin-top:6px; font-size:11px; color:var(--muted); text-align:right; }

  &__composer{ border-top:1px solid var(--border); height:56px; display:grid; grid-template-columns:40px 1fr 44px; align-items:center; gap:8px; padding:0 8px; }
  &__clip, &__send{ display:flex; align-items:center; justify-content:center; color:var(--muted); }
  &__input{ height:36px; border:1px solid var(--border); border-radius:10px; padding:0 12px; color:var(--ink); width:100%; }
  &__empty{ display:flex; align-items:center; justify-content:center; color:var(--muted); padding:20px; }

  @media (max-width:360px){
    &__sidebar-header{ height:52px; }
    &__search-input{ height:34px; font-size:13px; }
    &__avatar{ width:40px; height:40px; }
    &__composer{ height:52px; grid-template-columns:36px 1fr 40px; }
  }
}

/* ===== Лиды (форма + таблица) ===== */
.lead-board{
  $radius:14px; $shadow:0 10px 30px rgba(2,6,23,.08);
  max-width:1240px; margin:0 auto; background:#fff; border:1px solid var(--border); border-radius:$radius; box-shadow:$shadow;
  padding:12px; display:grid; gap:12px;

  &__header{ display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap; }
  &__title{ margin:0; font-size:18px; }
  &__hint{ color:var(--muted); font-size:12px; }
}

/* Форма */
.lead-form{
  display:grid; grid-template-columns: repeat(6,1fr); gap:10px;
  @media (max-width:980px){ grid-template-columns: repeat(3,1fr); }
  @media (max-width:560px){ grid-template-columns: 1fr; }

  &__field{ display:grid; gap:6px; }
  &__label{ color:var(--muted); font-size:12px; }
  &__input{
    height:36px; border:1px solid var(--border); border-radius:10px; padding:0 10px; color:var(--ink); background:#fff; width:100%;
    &--error{ border-color:var(--lost); box-shadow:0 0 0 2px rgba(239,68,68,.12); }
  }
  &__sub{ color:var(--muted); font-size:12px; }
  &__actions{ grid-column:1 / -1; display:flex; justify-content:flex-end; }
  &__btn{ height:36px; padding:0 14px; border:1px solid var(--accent); background:#fff; border-radius:10px; cursor:pointer; }
}

/* Фильтры */
.lead-filters{
  display:flex; gap:10px; flex-wrap:wrap;
  &__group{ display:flex; align-items:center; gap:8px; }
  &__label{ color:var(--muted); font-size:12px; }
  &__control{ height:32px; border:1px solid var(--border); border-radius:8px; background:#fff; padding:0 8px; }
}

/* Таблица */
.lead-table{
  border:1px dashed var(--border); border-radius:12px; overflow:hidden;

  &__row{ display:grid; grid-template-columns: 1.1fr 1.2fr .9fr .6fr .9fr 1.4fr 1.1fr .9fr; border-bottom:1px solid #f3f4f6; }
  &__row--head{ background:#fafafa; font-weight:600; }
  &__col{ padding:10px 12px; font-size:14px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  @media (max-width:980px){
    &__row{ grid-template-columns: 1fr 1fr; }
    &__row--head{ display:none; }
    &__col{ border-bottom:1px dashed #f1f5f9; }
  }

  &__input{ height:32px; border:1px solid var(--border); border-radius:8px; background:#fff; padding:0 8px; width:100%; }
  &__tag{ display:inline-flex; align-items:center; justify-content:center; min-width:28px; height:22px; border-radius:999px; background:#eef2ff; padding:0 8px; font-size:12px; }
  &__tag--wa{ background:#eafff2; border:1px solid rgba(37,211,102,.35); }
  &__tag--ig{ background:#fff0f6; border:1px solid rgba(225,48,108,.35); }
}

/* Менеджеры (админ) */
.mgr-admin{
  border:1px solid var(--border); border-radius:12px; padding:10px; display:grid; gap:10px; background:#fff;

  &__head{ display:flex; align-items:center; justify-content:space-between; }
  &__title{ font-weight:700; }
  &__meta{ color:var(--muted); font-size:12px; }

  &__list{ display:grid; grid-template-columns: repeat(3,1fr); gap:10px;
    @media (max-width:760px){ grid-template-columns: repeat(2,1fr); }
    @media (max-width:480px){ grid-template-columns: 1fr; }
  }
  &__item{ border:1px solid var(--border); border-radius:12px; padding:10px; display:flex; align-items:center; gap:10px; }
  &__avatar{ width:36px; height:36px; border-radius:50%; background:#111827; color:#fff; display:flex; align-items:center; justify-content:center; font-weight:700; }
  &__name{ flex:1; font-weight:600; }
  &__remove{ width:28px; height:28px; display:flex; align-items:center; justify-content:center; border:1px solid var(--border); background:#fff; border-radius:999px; }
}

/* ===== Аналитика ===== */
.analytics{
  $radius:14px; $shadow:0 10px 30px rgba(2,6,23,.08);
  max-width:1240px; margin:0 auto; background:#fff; border:1px solid var(--border); border-radius:$radius; box-shadow:$shadow;
  padding:12px; display:grid; gap:12px;

  &__header{ display:flex; justify-content:space-between; align-items:center; }
  &__title{ margin:0; font-size:18px; }

  &__kpi{ display:grid; grid-template-columns: repeat(5,1fr); gap:10px;
    @media (max-width:980px){ grid-template-columns: repeat(3,1fr); }
    @media (max-width:560px){ grid-template-columns: repeat(2,1fr); }
  }
  &__card{ border:1px solid var(--border); border-radius:12px; padding:10px; display:grid; gap:6px; }
  &__kpi-title{ color:var(--muted); font-size:12px; }
  &__kpi-value{ font-weight:700; font-size:18px; }

  &__list{ display:grid; gap:10px; }
  &__item{ display:flex; gap:12px; border:1px solid var(--border); border-radius:12px; padding:10px; }
  &__avatar{ width:40px; height:40px; border-radius:50%; background:#111827; color:#fff; display:flex; align-items:center; justify-content:center; font-weight:700; }
  &__info{ flex:1; display:grid; gap:8px; min-width:0; }
  &__name{ font-weight:700; }
  &__meta{ color:var(--muted); font-size:13px; }
  &__stack{ height:10px; background:#f3f4f6; border-radius:999px; overflow:hidden; display:flex; }
  &__seg{ height:100%; display:block; }
  &__seg--won{ background:var(--ok); }
  &__seg--mid{ background:var(--mid); }
  &__seg--lost{ background:var(--lost); }
  &__reasons{ display:flex; flex-wrap:wrap; gap:8px; }
  &__chip{ padding:6px 10px; border:1px dashed var(--border); border-radius:999px; background:#fff; font-size:12px; color:var(--muted); }
}

/* ===== Аналитика по видам спорта ===== */
.sport-analytics{
  &__title{ margin:4px 0 0; font-size:16px; }
  &__grid{ display:grid; grid-template-columns: repeat(3,1fr); gap:10px;
    @media (max-width:900px){ grid-template-columns: repeat(2,1fr); }
    @media (max-width:560px){ grid-template-columns: 1fr; }
  }
  &__card{ border:1px solid var(--border); border-radius:12px; padding:10px; background:#fff; display:grid; gap:6px; }
  &__sport{ font-weight:600; }
  &__meta{ color:var(--muted); font-size:12px; }
  &__bar{ position:relative; height:8px; background:#f3f4f6; border-radius:999px; overflow:hidden; }
  &__won{ position:absolute; inset:0 auto 0 0; background:var(--ok); }
}

/* ===== Модалка лида ===== */
.lead-modal{
  position:fixed; inset:0; background:rgba(0,0,0,.4); display:flex; align-items:center; justify-content:center; padding:16px; z-index:50;

  &__card{
    width:min(720px,100%); background:#fff; border:1px solid var(--border); border-radius:14px; box-shadow:0 10px 30px rgba(2,6,23,.2);
    display:grid; gap:10px; padding:12px;
  }
  &__header{ display:flex; align-items:center; justify-content:space-between; }
  &__title{ font-weight:700; }
  &__close{ width:32px; height:32px; border:1px solid var(--border); background:#fff; border-radius:999px; cursor:pointer; }

  &__form{ display:grid; grid-template-columns: repeat(2,1fr); gap:10px;
    @media (max-width:560px){ grid-template-columns:1fr; }
  }
  &__field{ display:grid; gap:6px; }
  &__field--wide{ grid-column:1 / -1; }
  &__label{ color:var(--muted); font-size:12px; }
  &__input{
    height:36px; border:1px solid var(--border); border-radius:10px; padding:0 10px; color:var(--ink); background:#fff; width:100%;
    &--area{ height:auto; padding:8px 10px; resize:vertical; }
    &--error{ border-color:var(--lost); box-shadow:0 0 0 2px rgba(239,68,68,.12); }
  }
  &__row{ grid-column:1 / -1; display:flex; gap:8px; flex-wrap:wrap; }
  &__pill{ padding:6px 10px; border:1px solid var(--border); border-radius:999px; font-size:12px; }
  &__pill--ok{ border-color:var(--ok); }

  &__actions{ grid-column:1 / -1; display:flex; justify-content:flex-end; }
  &__btn{ height:36px; padding:0 14px; border:1px solid var(--accent); background:#fff; border-radius:10px; cursor:pointer; }
}
